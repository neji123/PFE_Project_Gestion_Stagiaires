<h2 mat-dialog-title>
  <div class="dialog-title-container">
    <mat-icon [style.color]="getTypeColor()">{{ getFileIcon() }}</mat-icon>
    <span>{{ getDialogTitle() }}</span>
  </div>
</h2>

<form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">
  <mat-dialog-content class="upload-dialog-content">
    <div *ngIf="isLoading" class="loading-overlay">
      <mat-spinner [diameter]="40"></mat-spinner>
      <p>{{ data.isResubmission ? 'Re-soumission en cours...' : 'Téléversement en cours...' }}</p>
    </div>
    
    <!-- Informations sur le type de rapport -->
    <div *ngIf="reportType" class="report-type-info">
      <div class="type-header">
        <mat-icon [style.color]="reportType.color">{{ reportType.iconClass }}</mat-icon>
        <div class="type-details">
          <h4>{{ reportType.name }}</h4>
          <p *ngIf="reportType.description">{{ reportType.description }}</p>
        </div>
      </div>
      
      <!-- Échéance prévue -->
      <div *ngIf="getExpectedDeadline()" class="deadline-info">
        <mat-icon>schedule</mat-icon>
        <span>{{ getExpectedDeadline() }}</span>
      </div>
      
      <!-- Avertissement pour les rapports auto-générés -->
      <div *ngIf="shouldShowAutoGeneratedWarning()" class="auto-generated-warning">
        <mat-icon color="warn">info</mat-icon>
        <span>Ce rapport est normalement généré automatiquement. Assurez-vous de suivre les instructions spécifiques.</span>
      </div>
    </div>
    
    <!-- Message de re-soumission -->
    <div *ngIf="data.isResubmission" class="resubmission-notice">
      <mat-icon color="accent">refresh</mat-icon>
      <div>
        <strong>Re-soumission de rapport</strong>
        <p>Vous re-soumettez ce rapport suite à un rejet. Le nouveau fichier remplacera l'ancien.</p>
      </div>
    </div>
    
    <div class="form-field-container">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Titre du document</mat-label>
        <input matInput formControlName="title" placeholder="Ex: Convention de stage">
        <mat-hint>Titre qui apparaîtra dans votre liste de documents</mat-hint>
        <mat-error *ngIf="uploadForm.get('title')?.hasError('required')">
          Le titre est requis
        </mat-error>
        <mat-error *ngIf="uploadForm.get('title')?.hasError('maxlength')">
          Le titre ne doit pas dépasser 100 caractères
        </mat-error>
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Description (optionnelle)</mat-label>
        <textarea matInput formControlName="description" rows="3" 
                  placeholder="Entrez une description ou des commentaires sur ce document"></textarea>
        <mat-hint>Informations supplémentaires pour votre tuteur</mat-hint>
        <mat-error *ngIf="uploadForm.get('description')?.hasError('maxlength')">
          La description ne doit pas dépasser 500 caractères
        </mat-error>
      </mat-form-field>
      
      <div class="file-upload-container">
        <label for="file-upload" class="file-upload-label">
          <div class="upload-zone" [class.has-file]="selectedFile" [style.border-color]="getTypeColor()"
               (dragover)="$event.preventDefault()" (drop)="$event.preventDefault(); onFileSelected($event)">
            <mat-icon [style.color]="getTypeColor()">cloud_upload</mat-icon>
            <span *ngIf="!selectedFile" class="upload-text">
              <strong>Glissez votre fichier PDF ici</strong><br>
              <small>ou cliquez pour sélectionner</small>
            </span>
            <span *ngIf="selectedFile" class="file-selected">
              <mat-icon color="primary">check_circle</mat-icon>
              <strong>{{ selectedFile.name }}</strong><br>
              <small>{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</small>
            </span>
          </div>
        </label>
        <input type="file" id="file-upload" hidden (change)="onFileSelected($event)" accept="application/pdf">
        
        <div *ngIf="uploadForm.get('file')?.invalid && (uploadForm.get('file')?.dirty || uploadForm.get('file')?.touched)" class="file-error">
          <mat-icon color="warn">error</mat-icon>
          <span *ngIf="uploadForm.get('file')?.hasError('required')">
            Veuillez sélectionner un fichier
          </span>
          <span *ngIf="uploadForm.get('file')?.hasError('invalidFileType')">
            Veuillez sélectionner un fichier PDF
          </span>
          <span *ngIf="uploadForm.get('file')?.hasError('invalidFileSize')">
            Le fichier est trop volumineux (max 10MB)
          </span>
        </div>
      </div>
      
      <div class="upload-info">
        <mat-icon>info</mat-icon>
        <div class="info-content">
          <span><strong>Formats acceptés:</strong> PDF uniquement</span>
          <span><strong>Taille maximale:</strong> 10 MB</span>
          <span><strong>Recommandation:</strong> Nommez vos fichiers de manière claire</span>
        </div>
      </div>
      
      <!-- Message d'erreur général -->
      <div *ngIf="errorMessage" class="error-message">
        <mat-icon color="warn">error</mat-icon>
        <span>{{ errorMessage }}</span>
      </div>
    </div>
  </mat-dialog-content>
  
  <mat-dialog-actions align="end">
    <button mat-button type="button" (click)="onCancel()" [disabled]="isLoading">
      Annuler
    </button>
    <button mat-raised-button color="primary" type="submit" 
            [disabled]="uploadForm.invalid || isLoading" 
            [style.background-color]="getTypeColor()">
      <mat-icon>cloud_upload</mat-icon> 
      {{ data.isResubmission ? 'Re-soumettre' : 'Soumettre' }}
    </button>
  </mat-dialog-actions>
</form>